{-
  Id: stl:4j4rCC1R-6vHqghw-KSKgmbD-Ec9DPDA-IRqa6~L-aZ_1GRM#susan-olympic-minute
  Name: RGBCommit
  Version: 0.1.0
  Description: Consensus commitment layer for RGB smart contracts
  Author: Dr Maxim Orlovsky <orlovsky@lnp-bp.org>
  Copyright (C) 2023-2024 LNP/BP Standards Association. All rights reserved.
  License: Apache-2.0
-}

@context
typelib RGBCommit

import BPCore#juliet-super-dominic
  use BlindSealTxid#halt-crash-valid
  use SecretSeal#dollar-iris-wizard
  use BlindSealTxPtr#content-paradox-dominic
  use TxPtr#italian-july-eddie

import CommitVerify#violet-panther-herbert
  use MerkleHash#horse-popcorn-bundle
  use StrictHash#pizza-sherman-sound

import Std#delete-roman-hair
  use AsciiPrintable#ultra-sunset-format
  use AlphaNumLodash#percent-bingo-caesar
  use AlphaCapsLodash#duet-hammer-labor
  use AlphaSmallLodash#pioneer-eagle-spell

import AluVM#jargon-gorilla-poetic
  use LibSite#ultra-grace-message
  use LibId#germany-culture-olivia

import StrictTypes#henry-heart-survive
  use FieldName#present-flute-herman
  use TypeName#edgar-carol-mystery
  use SemId#logic-absorb-hilton

import Bitcoin#signal-color-cipher
  use Vout#brush-gloria-heroic
  use Txid#shallow-light-reverse


@mnemonic(alert-segment-canoe)
data AssignFungibleStateBlindSealTxPtr : revealed (seal BPCore.BlindSealTxPtr, state FungibleState)
                       | secretSeal (seal BPCore.SecretSeal, state FungibleState)

@mnemonic(sushi-herman-gamma)
data AssignFungibleStateBlindSealTxid : revealed (seal BPCore.BlindSealTxid, state FungibleState)
                       | secretSeal (seal BPCore.SecretSeal, state FungibleState)

@mnemonic(aloha-urban-factor)
data AssignStructureddDataBlindSealTxPtr : revealed (seal BPCore.BlindSealTxPtr, state StructureddData)
                       | secretSeal (seal BPCore.SecretSeal, state StructureddData)

@mnemonic(diploma-declare-domain)
data AssignStructureddDataBlindSealTxid : revealed (seal BPCore.BlindSealTxid, state StructureddData)
                       | secretSeal (seal BPCore.SecretSeal, state StructureddData)

@mnemonic(gong-bronze-critic)
data AssignVecAssignFungibleStateBlindSealTxPtr : [AssignFungibleStateBlindSealTxPtr ^ 1..]

@mnemonic(detect-orchid-finish)
data AssignVecAssignFungibleStateBlindSealTxid : [AssignFungibleStateBlindSealTxid ^ 1..]

@mnemonic(citizen-telecom-albert)
data AssignVecAssignStructureddDataBlindSealTxPtr : [AssignStructureddDataBlindSealTxPtr ^ 1..]

@mnemonic(avatar-boris-felix)
data AssignVecAssignStructureddDataBlindSealTxid : [AssignStructureddDataBlindSealTxid ^ 1..]

@mnemonic(begin-process-outside)
data AssignVecAssignVoidStateBlindSealTxPtr : [AssignVoidStateBlindSealTxPtr ^ 1..]

@mnemonic(arena-neuron-cantina)
data AssignVecAssignVoidStateBlindSealTxid : [AssignVoidStateBlindSealTxid ^ 1..]

@mnemonic(amazon-loyal-jazz)
data AssignVoidStateBlindSealTxPtr : revealed (seal BPCore.BlindSealTxPtr, state VoidState)
                       | secretSeal (seal BPCore.SecretSeal, state VoidState)

@mnemonic(labor-package-normal)
data AssignVoidStateBlindSealTxid : revealed (seal BPCore.BlindSealTxid, state VoidState)
                       | secretSeal (seal BPCore.SecretSeal, state VoidState)

@mnemonic(sabine-magic-deal)
data AssignmentDetails : ownedStateSchema OwnedStateSchema
                       , name StrictTypes.FieldName
                       , defaultTransition TransitionType

@mnemonic(secret-penguin-limit)
data AssignmentType    : U16

@mnemonic(mercy-first-clone)
data AssignmentsBlindSealTxPtr : {AssignmentType -> TypedAssignsBlindSealTxPtr}

@mnemonic(extra-signal-alaska)
data AssignmentsBlindSealTxid : {AssignmentType -> TypedAssignsBlindSealTxid}

@mnemonic(fiesta-gilbert-fiber)
data BaseCommitment    : schemaId SchemaId
                       , timestamp I64
                       , issuer CommitVerify.StrictHash
                       , chainNet ChainNet
                       , sealClosingStrategy SealClosingStrategy

@mnemonic(ringo-fashion-enrico)
data ChainNet          : bitcoinMainnet | bitcoinTestnet3 | bitcoinTestnet4 | bitcoinSignet
                       | bitcoinRegtest | liquidMainnet | liquidTestnet


@mnemonic(uniform-welcome-papa)
data ContractId        : [Byte ^ 32]

@mnemonic(pigment-career-hippie)
data Ffv               : U16

@mnemonic(citrus-miami-geneva)
data FungibleState     : U64

@mnemonic(salami-water-climax)
data Genesis           : ffv Ffv
                       , schemaId SchemaId
                       , timestamp I64
                       , issuer Identity
                       , chainNet ChainNet
                       , sealClosingStrategy SealClosingStrategy
                       , metadata Metadata
                       , globals GlobalState
                       , assignments AssignmentsBlindSealTxid

@mnemonic(strong-mister-version)
data GenesisSchema     : metadata {MetaType ^ ..0xff}
                       , globals {GlobalStateType -> ^ ..0xff Occurrences}
                       , assignments {AssignmentType -> ^ ..0xff Occurrences}
                       , validator AluVM.LibSite?

@mnemonic(eddie-super-cartoon)
data GlobalDetails     : globalStateSchema GlobalStateSchema, name StrictTypes.FieldName

@mnemonic(initial-malta-sierra)
data GlobalState       : {GlobalStateType -> ^ ..0xff GlobalValues}

@mnemonic(zipper-pioneer-visa)
data GlobalStateSchema : semId StrictTypes.SemId, maxItems U24

@mnemonic(yoga-quick-jasmine)
data GlobalStateType   : U16

@mnemonic(single-rodent-appear)
data GlobalValues      : [StructureddData ^ 1..]

@mnemonic(smart-pioneer-nominal)
data Identity          : Std.AsciiPrintable, [Std.AsciiPrintable ^ ..0xfff]

@mnemonic(judo-invest-thermos)
data Inputs            : {Opout ^ 1..}

@mnemonic(arena-janet-prepare)
data MetaDetails       : semId StrictTypes.SemId, name StrictTypes.FieldName

@mnemonic(quebec-mission-quota)
data MetaType          : U16

@mnemonic(split-package-recycle)
data MetaValue         : [Byte]

@mnemonic(retro-mozart-formal)
data Metadata          : {MetaType -> ^ ..0xff MetaValue}

@mnemonic(source-olga-mirage)
data Occurrences       : min U16, max U16

@mnemonic(oregano-dexter-exact)
data OpCommitment      : ffv Ffv
                       , nonce U64
                       , opType TypeCommitment
                       , metadata CommitVerify.StrictHash
                       , globals CommitVerify.MerkleHash
                       , inputs CommitVerify.MerkleHash
                       , assignments CommitVerify.MerkleHash

@mnemonic(picnic-single-gloria)
data OpId              : [Byte ^ 32]

@mnemonic(child-morning-compare)
data Opout             : op OpId
                       , ty AssignmentType
                       , no U16

@mnemonic(river-neon-user)
data OwnedStateSchema  : declarative ()
                       | fungible ()
                       | structured StrictTypes.SemId

@mnemonic(burma-bambino-nobody)
data Schema            : ffv Ffv
                       , name StrictTypes.TypeName
                       , metaTypes {MetaType -> ^ ..0xff MetaDetails}
                       , globalTypes {GlobalStateType -> ^ ..0xff GlobalDetails}
                       , ownedTypes {AssignmentType -> ^ ..0xff AssignmentDetails}
                       , genesis GenesisSchema
                       , transitions {TransitionType -> ^ ..0xff TransitionDetails}
                       , defaultAssignment AssignmentType?

@mnemonic(ramirez-patron-simon)
data SchemaId          : [Byte ^ 32]

@mnemonic(exile-target-catalog)
data SealClosingStrategy : firstOpretOrTapret | (|)


@mnemonic(ferrari-zebra-tempo)
data Signature         : [Byte ^ 64]

@mnemonic(jerome-format-saga)
data StructureddData   : [Byte]

@mnemonic(remark-gravity-vitamin)
data Transition        : ffv Ffv
                       , contractId ContractId
                       , nonce U64
                       , transitionType TransitionType
                       , metadata Metadata
                       , globals GlobalState
                       , inputs Inputs
                       , assignments AssignmentsBlindSealTxPtr
                       , signature Signature?

@mnemonic(orbit-pattern-goblin)
data TransitionDetails : transitionSchema TransitionSchema, name StrictTypes.FieldName

@mnemonic(scratch-magnum-polaris)
data TransitionSchema  : metadata {MetaType ^ ..0xff}
                       , globals {GlobalStateType -> ^ ..0xff Occurrences}
                       , inputs {AssignmentType -> ^ ..0xff Occurrences}
                       , assignments {AssignmentType -> ^ ..0xff Occurrences}
                       , validator AluVM.LibSite?

@mnemonic(picture-reflex-brigade)
data TransitionType    : U16

@mnemonic(yellow-young-stone)
data TypeCommitment    : genesis BaseCommitment
                       | transition (ContractId, TransitionType)

@mnemonic(civil-flex-palma)
data TypedAssignsBlindSealTxPtr : declarative AssignVecAssignVoidStateBlindSealTxPtr
                       | fungible AssignVecAssignFungibleStateBlindSealTxPtr
                       | structured AssignVecAssignStructureddDataBlindSealTxPtr

@mnemonic(switch-orchid-kevin)
data TypedAssignsBlindSealTxid : declarative AssignVecAssignVoidStateBlindSealTxid
                       | fungible AssignVecAssignFungibleStateBlindSealTxid
                       | structured AssignVecAssignStructureddDataBlindSealTxid

@mnemonic(email-snow-safari)
data VoidState         : ()


