{-
  Id: stl:xUbOLDKE-fdwcpqk-Dsx2Kuc-gTeaHnF-GBQ4HNC-G7fwA8k#salt-polka-roger
  Name: RGBCommit
  Version: 0.1.0
  Description: Consensus commitment layer for RGB smart contracts
  Author: Dr Maxim Orlovsky <orlovsky@lnp-bp.org>
  Copyright (C) 2023-2024 LNP/BP Standards Association. All rights reserved.
  License: Apache-2.0
-}

@context
typelib RGBCommit

import StrictTypes#century-comrade-chess
  use TypeName#edgar-carol-mystery
  use SemId#logic-absorb-hilton

import CommitVerify#escort-between-doctor
  use ReservedBytes1#origin-roger-relax
  use ReservedBytes2#florida-libra-circus
  use ReservedBytes4#young-goblin-academy
  use ReservedBytes8#rudolf-tape-adrian

import Std#ralph-blue-lucky
  use AsciiPrintable#ultra-sunset-format
  use Bool#oxygen-complex-duet
  use AlphaCapsNum#aladdin-zebra-marble
  use AlphaNumLodash#percent-bingo-caesar
  use AlphaCapsLodash#duet-hammer-labor

import AluVM#journal-basil-virus
  use IsaId#mobile-letter-absorb
  use LibId#germany-culture-olivia
  use CoreConfig#postage-harbor-judge
  use LibSite#polo-macro-elite
  use Fq#gamma-shine-rabbit


@mnemonic(import-cantina-square)
data AssignSeal        : seal [Byte ^ 32]
                       , state VerifiableState
                       , lock CommitVerify.ReservedBytes2
                       , fallback CommitVerify.ReservedBytes1

@mnemonic(pilot-finland-betty)
data AssignmentType    : U8

@mnemonic(control-journal-except)
data AssignmentsSeal   : {AssignmentType -> ^ ..0xff TypedAssignsSeal}

@mnemonic(factor-hair-everest)
data AttachId          : [Byte ^ 32]

@mnemonic(uniform-welcome-papa)
data ContractId        : [Byte ^ 32]

@mnemonic(omega-cowboy-oscar)
data ExtensionSeal     : ffv Ffv
                       , contractId ContractId
                       , extensionType ExtensionType
                       , metadata Metadata
                       , globals GlobalState
                       , assignments AssignmentsSeal
                       , reserved CommitVerify.ReservedBytes4

@mnemonic(susan-user-flash)
data ExtensionType     : U8

@mnemonic(pigment-career-hippie)
data Ffv               : U16

@mnemonic(stamp-plastic-hope)
data FieldArrayu128    : none ()
                       | single U128
                       | double (U128, U128)
                       | three (U128, U128, U128)
                       | four (U128, U128, U128, U128)

@mnemonic(spark-balloon-result)
data FieldArrayu32     : none ()
                       | single U32
                       | double (U32, U32)
                       | three (U32, U32, U32)
                       | four (U32, U32, U32, U32)

@mnemonic(gold-hawaii-gregory)
data FieldArrayu64     : none ()
                       | single U64
                       | double (U64, U64)
                       | three (U64, U64, U64)
                       | four (U64, U64, U64, U64)

@mnemonic(cargo-isotope-minute)
data GenesisHeader     : ffv Ffv
                       , flags CommitVerify.ReservedBytes1
                       , timestamp I64
                       , issuer Identity
                       , layer1 Layer1

@mnemonic(rent-image-gallery)
data GenesisSeal       : schema Schema
                       , header GenesisHeader
                       , metadata Metadata
                       , globals GlobalState
                       , assignments AssignmentsSeal
                       , reserved CommitVerify.ReservedBytes4

@mnemonic(initial-malta-sierra)
data GlobalState       : {GlobalStateType -> ^ ..0xff GlobalValues}

@mnemonic(europe-senator-gregory)
data GlobalStateSchema : maxLen U16
                       , semId StrictTypes.SemId?
                       , reserved CommitVerify.ReservedBytes4

@mnemonic(script-pasta-detail)
data GlobalStateType   : U8

@mnemonic(iris-orlando-bikini)
data GlobalValues      : [State ^ 1..]

@mnemonic(smart-pioneer-nominal)
data Identity          : Std.AsciiPrintable, [Std.AsciiPrintable ^ ..0xfff]

@mnemonic(tulip-pizza-window)
data Input             : prevOut Opout
                       , fallback CommitVerify.ReservedBytes1
                       , reserved CommitVerify.ReservedBytes2

@mnemonic(taboo-lazarus-sushi)
data Inputs            : {Input ^ 1..}

@mnemonic(torso-falcon-engine)
data Layer1            : bitcoin | liquid | bitcoinTest#240 | liquidTest


@mnemonic(greek-object-canal)
data MetaType          : U8

@mnemonic(sheriff-orlando-stone)
data Metadata          : {MetaType -> ^ ..0xff VerifiableState}

@mnemonic(picnic-single-gloria)
data OpId              : [Byte ^ 32]

@mnemonic(child-morning-compare)
data Opout             : op OpId
                       , ty AssignmentType
                       , no U16

@mnemonic(cotton-oregano-under)
data Schema            : ffv Ffv
                       , flags CommitVerify.ReservedBytes1
                       , name StrictTypes.TypeName
                       , timestamp I64
                       , developer Identity
                       , global {GlobalStateType -> ^ ..0xff GlobalStateSchema}
                       , vm VmSchema
                       , validators Validators
                       , reserved CommitVerify.ReservedBytes8

@mnemonic(galaxy-lunch-sherman)
data State             : verifiable VerifiableState, unverified UnverifiedState

@mnemonic(yoga-basil-morph)
data TransitionSeal    : ffv Ffv
                       , contractId ContractId
                       , transitionType TransitionType
                       , inputs Inputs
                       , metadata Metadata
                       , globals GlobalState
                       , assignments AssignmentsSeal
                       , reserved CommitVerify.ReservedBytes4

@mnemonic(simple-bicycle-junior)
data TransitionType    : U8

@mnemonic(special-hammer-beatles)
data TypedAssignsSeal  : [AssignSeal ^ 1..]

@mnemonic(river-bambino-join)
data UnverifiedState   : ty CommitVerify.ReservedBytes1
                       , data [Byte]
                       , attach AttachId?

@mnemonic(queen-matrix-sport)
data Validators        : genesisValidator AluVM.LibSite
                       , extensionValidators {ExtensionType -> ^ ..0xff AluVM.LibSite}
                       , transitionValidators {TransitionType -> ^ ..0xff AluVM.LibSite}
                       , defaultTransitionValidator AluVM.LibSite
                       , defaultExtensionValidator AluVM.LibSite

@mnemonic(china-trumpet-place)
data VerifiableState   : le32bit#16 FieldArrayu32
                       | le64bit FieldArrayu64
                       | le128Bit FieldArrayu128

@mnemonic(user-poker-oregano)
data VmSchema          : aluVm#1 ({AluVM.IsaId ^ ..0xff}, AluVM.CoreConfig) | (|)


